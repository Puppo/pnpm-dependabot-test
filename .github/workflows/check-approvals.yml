name: Enforce Review Policy

on:
  # Run when PR is opened/updated
  pull_request:
    types: [opened, synchronize, reopened]
  # CRITICAL: Also run when a review is submitted so the check updates status
  pull_request_review:
    types: [submitted, dismissed]

jobs:
  check-review-count:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      statuses: write
    steps:
      - name: Checkout scripts
        uses: actions/checkout@v5
        with:
          fetch-depth: 0
          sparse-checkout: |
            .github
      - name: Check Approval Count
        uses: actions/github-script@v8
        with:
          script: |
            const { default: script } = await import('${{ github.workspace }}/.github/scripts/check-approvals.js')
            await script({github, context, core})
